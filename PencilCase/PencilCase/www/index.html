<!DOCTYPE html>
<html>
<head>
    <!--
        Customize the content security policy in the meta tag below as needed. Add 'unsafe-inline' to default-src to enable inline JavaScript.
        For details, see http://go.microsoft.com/fwlink/?LinkID=617521
    -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self' data: gap: https://ssl.gstatic.com 'unsafe-eval'; style-src 'self' 'unsafe-inline'; media-src *">

    <meta http-equiv="content-type" content="text/html; charset=UTF-8" />
    <meta name="format-detection" content="telephone=no">
    <meta name="msapplication-tap-highlight" content="no">
    <meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width">
    <link rel="stylesheet" type="text/css" href="css/index.css">
    <link rel="stylesheet" type="text/css" href="css/jquery.mobile-1.4.5.min.css">

    <script type="text/javascript" src="cordova.js"></script>
    <!-- The 'async' attribute is needed for RequireJS to work in a Windows app -->
    <script type="text/javascript" data-main="scripts/startup" src="lib/require.2.1.8.js" async></script>
    <script type="text/javascript" src="scripts/jquery-1.8.0.min.js"></script>
    <script type="text/javascript" src="scripts/jquery.mobile-1.4.5.min.js"></script>
    <script type="text/javascript" src="scripts/knockout-3.4.2.js"></script>
    <script type="text/javascript" src="scripts/CustomBindings/Bindings.js"></script>
    <script type="text/javascript" src="scripts/CustomBindings/ListviewBinding.js"></script>
    <script type="text/javascript" src="scripts/CustomBindings/SelectComponentInitialValueBinding.js"></script>
    <script type="text/javascript" src="scripts/CustomBindings/InitialSelectedTabBinding.js"></script>
    <script type="text/javascript" src="scripts/moment.min.js"></script>
</head>
<body>
    <!-- ==============Home Page================= -->
    <!-- Make sure the page id here is exactly the same as it defined in Consts.Pages -->
    <div data-role="page" id="HomePage">
        <!-- ko with: homePage() -->
        <div data-role="header" data-position="fixed">
            <h1>Pencil Case</h1>
        </div>
        <div role="main" class="ui-content">
            <div style="display: none" data-bind="visible: $parent.isDataLoaded">
                <a href="#Retail" class="ui-btn ui-corner-all" data-bind="click: openRetailPage">Retail</a>
                <a href="#Wholesale" class="ui-btn ui-corner-all" data-bind="disable: true">Wholesale</a>
                <a href="#ProductManagement" class="ui-btn ui-corner-all" data-bind="click: openProductManagementPage">Product Management</a>
                <a href="#DataAnalyse" class="ui-btn ui-corner-all">Data Analyse</a>
            </div>
            <div data-bind="visible: !$parent.isDataLoaded()">
                <h1>正在加载数据……</h1>
            </div>
        </div>
        <footer data-role="footer" data-position="fixed">
            <h4>@Copyright - Frank</h4>
        </footer>
        <!-- /ko -->
    </div>

    <!-- ==============Product Management Page================= -->
    <!-- Try not bind UI stuff on Home Page like header and footer, because such UI binding will be applied until device ready,
        and at that time, static UI already loaded for a while, it is confusing for users becasue they can note that UI loaded at 2 different time point. -->
    <!-- Make sure the page id here is exactly the same as it defined in Consts.Pages -->
    <div data-role="page" id="ProductManagement">
        <!-- ko if: activePage().pageId === 'ProductManagement' -->
        <!-- ko with: activePage() -->
        <div data-role="header" data-position="fixed">
            <a href="#HomePage" data-icon="home" data-bind="click: navigator.goHome">Home</a>
            <h1><span data-bind="text: title"></span></h1>
            <a href="#" data-icon="plus" class="ui-icon-plus" data-bind="click: addNewProduct">Add</a>
        </div>
        <div data-role="main" class="ui-content">
            <ul data-role="listview" data-inset="true" data-bind="foreach: products, listview: products">
                <li>
                    <a href="#" data-bind="click: $parent.showDetails">
                        <h2><span data-bind="text: Name"></span></h2>
                        <p>
                            <span>单价：</span>
                            <span data-bind="text: '￥' + RetailPrice"></span>
                        </p>
                        <p>
                            <span>批发价：</span>
                            <span data-bind="text: '￥' + WholesalePrice"></span>
                            <span data-bind="text: '(' + Times + RetailUnitName + '/' + WholesaleUnitName + ')'"></span>
                            <span class="ui-li-count" data-bind="text: '库存：' + Inventory"></span>
                        </p>
                    </a>
                </li>
            </ul>
        </div>
        <!-- /ko -->
        <!-- /ko -->
    </div>

    <!-- ============== Confirm Dialog ================= -->
    <!-- Public Confirm Dialog that everyone can use, so, for this app, there can be only one confirm dialog at one time -->
    <div data-role="dialog" id="ConfirmDialog">
        <!-- ko if: confirmDialog -->
        <!-- ko with: confirmDialog() -->
        <div data-role="content" class="ui-content ui-body-a">
            <h3><span data-bind="text: header"></span></h3>
            <p><span data-bind="text: content"></span></p>
            <fieldset class="ui-grid-a">
                <div class="ui-block-a"><a href="#" data-role="button" data-bind="click: confirm">是</a></div>
                <div class="ui-block-b"><a href="#" data-role="button" data-rel="back">否</a></div>
            </fieldset>
        </div>
        <!-- /ko -->
        <!-- /ko -->
    </div>

    <!-- ==============Product Editor Page================= -->
    <!-- Make sure the page id here is exactly the same as it defined in Consts.Pages -->
    <div data-role="page" id="ProductEditor">
        <!-- ko if: activePage().pageId === 'ProductEditor' -->
        <!-- ko with: activePage() -->
        <div data-role="header" data-position="fixed">
            <a href="#ProductManagement" data-icon="back" data-bind="click: goBack">Back</a>
            <h1><span data-bind="text: title"></span></h1>
        </div>
        <div data-role="main" class="ui-content">
            <div data-role="tabs" id="detailTabs" data-bind="visible: !isInEditingMode(), initialSelectedTab: {condition: isNotInEditingMode, selector: 'a[href=\'#detailsGeneral\']'}">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#detailsGeneral" data-ajax="false" class="ui-btn-active">General Info</a></li>
                        <li><a href="#detailsPrice" data-ajax="false">Prices</a></li>
                    </ul>
                </div>
                <div id="detailsGeneral" class="ui-body-d ui-content">
                    <form>
                        <p>
                            <span style="font-weight: bold">名称：</span><span data-bind="text: originalProduct().Name"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">描述：</span><span data-bind="text: originalProduct().Description"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">库存：</span><span data-bind="text: originalProduct().Inventory"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">图片：</span><span data-bind="text: '暂不可用'"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">创建时间：</span><span data-bind="text: moment(originalProduct().CreatedDate).format('YYYY-MM-DD')"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">上次修改时间：</span><span data-bind="text: moment(originalProduct().ModifiedDate).format('YYYY-MM-DD')"></span>
                        </p>

                    </form>
                </div>
                <div id="detailsPrice" class="ui-body-d ui-content">
                    <form>
                        <p>
                            <span style="font-weight: bold">零售单位：</span><span data-bind="text: originalProduct().RetailUnitName"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">零售价：</span><span data-bind="text: originalProduct().RetailPrice + '元'"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">批发单位：</span><span data-bind="text: originalProduct().WholesaleUnitName"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">单位关系：</span><span data-bind="text: originalProduct().Times + originalProduct().RetailUnitName + '/' + originalProduct().WholesaleUnitName"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">批发价：</span><span data-bind="text: originalProduct().WholesalePrice + '元'"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">进货价（按批发单位）：</span><span data-bind="text: originalProduct().ImportWholesalePrice + '元'"></span>
                        </p>
                        <p>
                            <span style="font-weight: bold">进货价（按零售单位）：</span><span data-bind="text: originalProduct().ImportRetailPrice + '元'"></span>
                        </p>
                    </form>
                </div>
            </div>

            <div data-role="tabs" id="editingTabs" data-bind="visible: isInEditingMode, initialSelectedTab: {condition: isInEditingMode, selector: 'a[href=\'#editingGeneral\']'}">
                <div data-role="navbar">
                    <ul>
                        <li><a href="#editingGeneral" data-ajax="false" class="ui-btn-active">General Info</a></li>
                        <li><a href="#editingPrice" data-ajax="false">Prices</a></li>
                    </ul>
                </div>
                <div id="editingGeneral" class="ui-body-d ui-content">
                    <form>
                        <label style="font-weight: bold" for="productName">名称：</label>
                        <input type="text" name="productName" data-bind="value: name" />
                        <label style="font-weight: bold" for="productDescription">描述：</label>
                        <textarea name="productDescription" data-bind="value: description"></textarea>
                        <label style="font-weight: bold" for="productInventory">库存：</label>
                        <input type="number" name="productInventory" data-bind="value: inventory" />
                        <label style="font-weight: bold">图片：</label>
                        <span data-bind="text: '暂不可用'"></span>
                    </form>
                </div>
                <div id="editingPrice" class="ui-body-d ui-content">
                    <form>
                        <label style="font-weight: bold" for="productRetailUnit">零售单位：</label>
                        <select name="productRetailUnit" data-bind="options: uomDataSource, optionsText: 'Name', optionsValue: 'Id', value: retailUnit, selectComponentInitialValue: retailUnit"></select>
                        <label for="productRetailPrice" style="font-weight: bold">零售价(元)：</label>
                        <input type="number" name="productRetailPrice" data-bind="value: retailPrice" />
                        <label for="productWholesaleUnit" style="font-weight: bold">批发单位：</label>
                        <select name="productWholesaleUnit" data-bind="options: uomDataSource, optionsText: 'Name', optionsValue: 'Id', value: wholesaleUnit, selectComponentInitialValue: wholesaleUnit"></select>
                        <label for="productTimes" style="font-weight: bold">单位关系：<span data-bind="text: '(如：12个每箱就填12)'"></span></label>
                        <input type="number" name="productTimes" data-bind="value: times" />
                        <label for="productWholesalePrice" style="font-weight: bold">批发价(元)：</label>
                        <input type="number" name="productWholesalePrice" data-bind="value: wholesalePrice" />
                        <!-- 此处应为成本价，TODO: 决定是否允许编辑，应由进货价格和库存计算得出 -->
                        <lable for="productImportRetailPrice" style="font-weight: bold">进货价(元)（按零售单位）：</lable>
                        <input type="number" name="productImportRetailPrice" data-bind="value: originalProduct().ImportRetailPrice, enable: false" />
                        <!-- 此处应为成本价，TODO: 决定是否允许编辑，应由进货价格和库存计算得出 -->
                        <lable for="productImportWholesalePrice" style="font-weight: bold">进货价(元)（按批发单位）：</lable>
                        <input type="number" name="productImportWholesalePrice" data-bind="value: originalProduct().ImportWholesalePrice, enable: false" />
                    </form>
                </div>
            </div>
        </div>
        <footer data-role="footer" data-position="fixed">
            <div data-role="navbar" data-grid="a">
                <ul>
                    <li>
                        <a id="editButton" href="#" data-bind="click: startEditing, visible: !isInEditingMode()" data-icon="edit">Edit</a>
                        <a id="saveButton" href="#" data-bind="click: save, visible: isInEditingMode" data-icon="check">Save</a>
                    </li>
                    <li>
                        <!-- click 绑定的方法名不能是delete，花了1小时发现的问题，难道是某种豫留关键字或什么东西。 -->
                        <a id="deleteButton" href="#" data-bind="click: deleteProduct, visible: !isInEditingMode()" data-icon="delete">Delete</a>
                        <a id="cancelButton" href="#" data-bind="click: cancel, visible: isInEditingMode" data-icon="arrow-u-l">Cancel</a>
                    </li>
                </ul>
            </div>
        </footer>
        <!-- /ko -->
        <!-- /ko -->
    </div>

    <!-- ==============Retail Page================= -->
    <!-- Make sure the page id here is exactly the same as it defined in Consts.Pages -->
    <div data-role="page" id="Retail">
        <!-- ko if: activePage().pageId === 'Retail' -->
        <!-- ko with: activePage() -->
        <div data-role="header">
            <a href="#HomePage" data-icon="home" data-bind="click: navigator.goHome">Home</a>
            <h1><span data-bind="text: title"></span></h1>
        </div>
        <div data-role="main" class="ui-content">
            <p>Retail Page</p>
        </div>
        <!-- /ko -->
        <!-- /ko -->
    </div>
</body>
</html>